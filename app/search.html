---
title: 搜尋結果頁｜
layout: ./app/layout.ejs
engine: ejs
current: search
---

<main id="app" class="flex-fill">
  <transition>
    <div v-show="loading" class="overlay position-absolute top-0 start-0 align-items-center justify-content-center w-100 h-100 bg-white z-index-2">
      <img src="assets/images/loading.gif" class="w-25" alt="載入動畫">
    </div>
  </transition>
  <section>
    <div class="container">
      <h1 class="section__title fs-md-1 fs-2 pb-10 mb-0 text-center">
        搜尋食譜
        <hr class="my-10 mx-auto opacity-100 border-0">
      </h1>
      <div class="row justify-content-center mb-40 pb-10">
        <div class="col-md-6">
          <div class="row justify-content-center">
            <div class="col-md-8">
              <form action="search.html" method="get" class="position-relative" role="search">
                <input v-model="keyword" name="text" type="text" class="form-control" placeholder="請輸入想搜尋的食譜" aria-label="Search">
                <button class="btn btn-link position-absolute top-50 end-0 translate-middle-y py-10 px-20" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <aside class="col-md-2 align-self-start mb-md-0 mb-40">
          <ul class="navbar-nav justify-content-center flex-md-column flex-row gap-20 mb-0">
            <li class="nav-item">
              <div class="form-check">
                <input class="form-check-input" v-model="channel" type="checkbox" value="全部" id="全部" @change="filter">
                <label class="form-check-label" for="全部">
                  全部
                </label>
              </div>
            </li>
            <li class="nav-item">
              <div class="form-check">
                <input class="form-check-input" v-model="channel" type="checkbox" value="傳統飲食" id="傳統飲食" @change="filter">
                <label class="form-check-label" for="傳統飲食">
                  傳統飲食
                </label>
              </div>
            </li>
            <li class="nav-item">
              <div class="form-check">
                <input class="form-check-input" v-model="channel" type="checkbox" value="燉菜類" id="燉菜類" @change="filter">
                <label class="form-check-label" for="燉菜類">
                  燉菜類
                </label>
              </div>
            </li>
            <li class="nav-item">
              <div class="form-check">
                <input class="form-check-input" v-model="channel" type="checkbox" value="小菜" id="小菜" @change="filter">
                <label class="form-check-label" for="小菜">
                  小菜
                </label>
              </div>
            </li>
          </ul>
        </aside>
        <div class="col-md-10">
          <div class="row g-40">
            <div class="col-md-3 col-6" v-for="item in list">
              <div class="card card-dish border-0">
                <div class="card-img position-relative p-10">
                  <span class="img-circle rounded-circle"></span>
                  <img :src="item.picture.thumbnail" class="img-fluid position-relative" :alt="item.name" referrerpolicy="no-referrer">
                </div>
                <div class="card-body pt-20 pb-0 px-0 text-center">
                  <div class="card-title fs-4 mb-0">{{ item.name }}</div>
                  <a :href="`recipe.html?id=${item.id}`" class="stretched-link"></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
<script type="module">
  import { createApp } from 'https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.26/vue.esm-browser.min.js';

  firebase.initializeApp({
    databaseURL: "https://sikdang-github-default-rtdb.firebaseio.com/"
  });
  const database = firebase.database();


  const app = createApp({
    data() {
      return {
        keyword: '',
        channel: [],
        list: [],
        temp: [],
        loading: true,
      }
    },
    mounted() {
      this.keyword = decodeURI(window.location.search.split('text=')[1]);
      this.getData();
    },
    methods: {
      getData() {
        database.ref("/recipes").once('value', (snapshot) => {
          const origin = snapshot.val();
          const key = Object.keys(origin);
          const value = Object.values(origin);
          value.forEach((element, index) => {
            element.id = key[index];
            this.list.push(element);
          });
        })
        .then(() => {
          this.search(this.keyword);
          this.temp = this.list;
          this.loading = false;
        });
      },
      search(keyword) {
        this.list = this.list.filter((element) => {
          return element.name.indexOf(keyword) > -1;
        });
      },
      filter() {
        this.list = this.temp; // 先把列表重置回全部
        const temp = [];
        if ( !this.channel.includes('全部') ) {
          this.channel.forEach((el) => {
            this.list.filter((element) => {
              if ( element.channel === el ) {
                temp.push(element);
              }
            });
          });
          this.list = temp;
        }
      },
    }
  })
  app.mount('#app')
</script>